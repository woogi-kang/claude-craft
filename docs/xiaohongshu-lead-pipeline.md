# 샤오홍슈 리드 제너레이션 파이프라인

한국 피부미용 의료관광 고객 유치 시스템

---

## 1. 사업 개요

### 목적

샤오홍슈(小红书/RED)를 통해 한국 피부미용/의료관광에 관심 있는 중국 유저를 발굴하고, 상담 및 예약으로 연결하는 리드 획득 파이프라인 구축.

### 타겟 유저

샤오홍슈에서 아래 주제로 게시물을 작성하는 중국 유저:
**성형외과나 의료가 아닌 에스테틱(헤어스파, 마사지 등)과 관련된 메세지는 제외하고 피부과 관련 컨텐츠에만 집중한다.**

- 한국 피부과 추천 요청
- 한국 피부시술 가격 문의
- 한국 피부 시술 추천
- 한국 의료관광 관련 불만/불안
- 피부과 시술 리뷰 요청

### 핵심 플로우

```
크롤링 전용 계정 (일회용) → 게시물/유저 수집 → DB 저장
                                                  ↓
                             작업 계정 → 타겟 유저에게 DM/댓글
```

---

## 2. 파이프라인 아키텍처

### 운영 모델: 24시간 상시 데몬

타겟 키워드로 한국 피부과 관련 게시물을 올리는 유저는 하루에 소수이므로, 대량 배치 처리가 아닌 **24시간 백그라운드에서 느리게 순환하는 데몬** 방식으로 운영한다.

```
┌─────────────────────────────────────────────────┐
│                 24시간 상시 데몬                    │
│                                                   │
│   ┌─────────┐    ┌─────────┐    ┌─────────┐     │
│   │  크롤링   │ →  │  큐레이션 │ →  │  자동발송  │     │
│   │ (2-4시간  │    │ (크롤링   │    │ (큐에 있는 │     │
│   │  간격)    │    │  직후)   │    │  건 순차)  │     │
│   └─────────┘    └─────────┘    └─────────┘     │
│        ↻ 전체 사이클 반복 ↻                         │
└─────────────────────────────────────────────────┘
```

**전체 사이클 타임라인 예시:**

| 시각 | 동작 | 소요 시간 |
|------|------|----------|
| 09:00 | 크롤링 시작 (키워드 순회) | 30-60분 |
| 10:00 | 수집된 게시물 LLM 큐레이션 | 5-10분 |
| 10:15 | 발송 큐 메세지 1건 발송 | 3-5분 |
| 10:45 | 발송 큐 메세지 2건 발송 | 3-5분 |
| ... | 큐 소진될 때까지 20-40분 간격으로 1건씩 | ... |
| 13:00 | 다음 크롤링 사이클 시작 | ... |
| ... | 하루 4-6 사이클 반복 | ... |

### Phase 1: 크롤링 (2-4시간 간격)

크롤링 계정으로 샤오홍슈에서 타겟 키워드를 검색하고, **24시간 이내** 게시물 url과 메세지를 수집하여 의도(intent)별로 분류 후 DB에 저장한다.
코드 수준에서 필터링하여 의도를 분류 한다.

```
[크롤링 계정 + 프록시]
    ↓
키워드 1개 검색 → 최신 탭 → 게시물 수집
    ↓
(키워드 간 랜덤 대기 2-5분)
    ↓
키워드 2개 검색 → 최신 탭 → 게시물 수집
    ↓
... 모든 키워드 순회 완료 ...
    ↓
DB 저장 + 의도 분류 + 중복 제거
    ↓
(다음 크롤링까지 2-4시간 대기)
```

**크롤링 시 주의사항:**
- 검색 결과에서 반드시 `最新(최신)` 탭 선택
- 게시물 작성일을 파싱하여 코드 레벨에서 24시간 필터 적용
- `post_id` 기준 중복 수집 방지
- 키워드 간 2-5분 랜덤 대기 (한 번에 몰아서 검색하지 않음)

### Phase 2: 큐레이션 (크롤링 직후)

크롤링에서 새로 수집된 게시물을 LLM이 읽고, 아웃리치 대상 여부를 판단한 뒤 메세지를 생성하여 발송 큐에 등록한다.

```
새로 수집된 게시물 목록
    ↓
LLM이 각 게시물을 읽고 아웃리치 필요 여부 판단
(불필요한 것은 llm_decision=false로 분리)
    ↓
필요한 게시물에 대해 맥락 맞는 응답 메세지 생성
    ↓
발송 큐에 등록 (status: pending)
```

### Phase 3: 자동 발송 (큐 소진까지 느리게)

발송 큐에 등록된 메세지를 Playwright가 작업 계정으로 **1건씩 느리게** 발송한다. 큐가 비면 다음 크롤링 사이클까지 대기한다.

```
발송 큐에서 1건 가져오기
    ↓
작업 계정 로그인 (프록시 경유, 세션 유지 중이면 스킵)
    ↓
대상 게시물 페이지 이동
    ↓
사람처럼 행동 시뮬레이션 (스크롤, 읽기 대기)
    ↓
댓글 또는 DM 발송
    ↓
DB 상태 업데이트 (status: sent)
    ↓
(다음 발송까지 20-40분 랜덤 대기)
    ↓
큐에 남은 건이 있으면 반복, 없으면 대기
```

**발송 시 행동 시뮬레이션:**

| 단계 | 동작 | 대기 시간 |
|------|------|----------|
| 게시물 페이지 진입 | 페이지 로드 완료 대기 | 3-5초 |
| 콘텐츠 읽기 | 천천히 스크롤 다운 | 10-30초 |
| 다른 게시물 구경 | 간헐적으로 다른 글도 열람 | 30-60초 (2-3건에 1번) |
| 댓글 입력 | 한 글자씩 타이핑 시뮬레이션 | 메세지 길이 x 0.08-0.15초 |
| 발송 버튼 클릭 | 클릭 후 결과 확인 | 2-3초 |
| 다음 발송 대기 | 랜덤 대기 | 20-40분 |

**하루 예상 처리량:**

| 항목 | 수치 |
|------|------|
| 크롤링 사이클 | 4-6회/일 |
| 사이클당 신규 게시물 | 5-15건 (키워드/시간대에 따라 변동) |
| LLM 필터 후 아웃리치 대상 | 3-10건/일 |
| 발송 간격 | 20-40분/건 |
| 일일 발송량 | 5-15건 (자연스러운 양) |

---

## 3. 타겟 키워드

### 주요 키워드 (실제로는 훨씬 더 많은 키워드로 확장 필요. 한국 울쎄라 등)

| 키워드 (중국어) | 의미 | 의도 유형 |
|---|---|---|
| 韩国皮肤管理多少钱 | 한국 피부관리 가격 | price |
| 韩国水光针价格 | 한국 물광주사 가격 | price |
| 韩国皮肤科推荐 | 한국 피부과 추천 | hospital |
| 去韩国做皮肤值得吗 | 한국 피부 시술 할 만한가 | review |
| 韩国医美避坑 | 한국 의료미용 주의사항 | complaint |
| 韩国皮肤科 | 한국 피부과 | hospital |
| 韩国医美 | 한국 의료미용 | procedure |
| 首尔皮肤管理 | 서울 피부관리 | hospital |
| 韩国激光祛斑 | 한국 레이저 기미 제거 | procedure |
| 韩国痘痘治疗 | 한국 여드름 치료 | procedure |
| 韩国超声刀 | 한국 울쎄라 | procedure |
| 韩国热玛吉 | 한국 써마지 | procedure |
| 韩国皮秒 | 한국 피코 | procedure |

### 제외 키워드

크롤링 시 아래 키워드가 포함된 게시물은 필터링하여 제외한다.

| 제외 대상 | 키워드 |
|---|---|
| 성형외과 | 整形, 双眼皮, 隆鼻, 削骨, 轮廓, 假体, 吸脂 |
| 에스테틱 | 按摩, 头皮, 美甲, 纹眉, 半永久, SPA, 头发 |
| 비한국 지역 | 日本医美, 泰国医美, 新加坡医美 |

---

## 4. DB 스키마

### 게시물 테이블 (posts)

| 필드 | 타입 | 설명 |
|---|---|---|
| post_id | TEXT PK | 샤오홍슈 게시물 고유 ID |
| user_id | TEXT FK | 작성자 유저 ID |
| contents | TEXT | 게시물 내용 |
| intent_type | TEXT | hospital / price / procedure / complaint / review |
| llm_decision | BOOL | LLM이 판단 후 아웃리치 메세지 작성 여부 |
| likes_count | INTEGER | 좋아요 수 |
| comments_count | INTEGER | 댓글 수 |
| post_url | TEXT | 게시물 직접 링크 |
| crawled_at | TIMESTAMP | 크롤링 시점 |
| created_at | TIMESTAMP | 게시물 작성일 |

### 아웃리치 테이블 (outreach)

| 필드 | 타입 | 설명 |
|---|---|---|
| outreach_id | INTEGER PK | 자동 증가 ID |
| post_id | TEXT FK | 대상 게시물 |
| user_id | TEXT FK | 대상 유저 |
| account_id | TEXT | 발송에 사용된 작업 계정 ID |
| outreach_type | TEXT | comment / dm |
| message | TEXT | LLM 생성 메세지 |
| status | TEXT | pending / scheduled / sent / failed |
| error_message | TEXT | 발송 실패 시 오류 내용 |
| replied | BOOL | 유저 응답 여부 |
| scheduled_at | TIMESTAMP | 발송 예약 시점 |
| sent_at | TIMESTAMP | 실제 발송 시점 |
| replied_at | TIMESTAMP | 유저 응답 시점 |
| created_at | TIMESTAMP | 레코드 생성일 |

### 작업 계정 테이블 (accounts)

| 필드 | 타입 | 설명 |
|---|---|---|
| account_id | TEXT PK | 계정 고유 ID |
| account_type | TEXT | crawl / outreach |
| proxy_ip | TEXT | 할당된 프록시 IP |
| status | TEXT | nurturing / active / cooldown / banned |
| maturity | TEXT | new / ready / mature |
| daily_comment_count | INTEGER | 오늘 발송한 댓글 수 |
| daily_dm_count | INTEGER | 오늘 발송한 DM 수 |
| last_warning_at | TIMESTAMP | 마지막 경고 수신 시점 |
| created_at | TIMESTAMP | 계정 생성일 |
| banned_at | TIMESTAMP | 정지된 시점 |

---

## 5. 의도 분류 (Intent Classification)

### 자동 분류 규칙

| 의도 유형 | 탐지 키워드 |
|---|---|
| hospital (병원 추천 요청) | 推荐, 求推荐, 哪家好, 靠谱的医院, 皮肤科推荐, 哪个医院, 去哪里, 求介绍 |
| price (가격 문의) | 多少钱, 价格, 费用, 贵不贵, 预算, 花了多少, 收费, 划算 |
| procedure (시술 관련 질문) | 水光针, 激光, 祛斑, 痘痘, 毛孔, 美白, 提升, 超声刀, 热玛吉, 皮秒, 光子嫩肤, 刷酸 |
| complaint (한국 피부과 관련 불안/불만) | 被坑, 踩雷, 后悔, 不靠谱, 翻车, 失败, 不满意, 投诉, 害怕, 担心 |
| review (후기 요청) | 效果怎么样, 有人去过吗, 求分享, 体验, 术后, 恢复期, 真实反馈 |

### 제외 필터 (의도 분류 전 적용)

아래 키워드가 포함된 게시물은 의도 분류 대상에서 제외:
- 성형: 整形, 双眼皮, 隆鼻, 削骨, 轮廓, 假体, 吸脂
- 에스테틱: 按摩, 头皮, 美甲, 纹眉, 半永久, SPA, 头发
- 비한국: 日本医美, 泰国医美, 新加坡医美

---

## 6. 아웃리치 메세지 작성을 위한 프롬프트

### 댓글 프롬프트 (LLM이 게시물 목적별로 별도 생성)

**추후 작성**

### 필수 원칙 (프롬프트에 포함 필요)

- 동일한 메시지 복붙 절대 금지
- 반드시 유저 게시물의 구체적 내용을 언급할 것
- 댓글에 연락처(전화번호, 위챗 ID) 직접 노출 금지

---

## 7. 기술 스택

| 구성 요소 | 기술 | 용도 |
|---|---|---|
| 크롤러 | Playwright (모바일 웹 시뮬레이션) | 샤오홍슈 페이지 스크래핑 |
| 자동 발송 | Playwright (모바일 웹 시뮬레이션) | 댓글/DM 자동 발송 |
| 프록시 (크롤링) | 중국 주거지 프록시 (고정 IP) | 크롤링 계정 IP 우회 |
| 프록시 (발송) | 중국 주거지 프록시 (고정 IP, 크롤링과 별도) | 작업 계정 IP 우회 |
| 데이터베이스 | PostgreSQL | 리드 데이터 + 발송 큐 저장 |
| 응답 생성 | LLM API (Gemini) | 게시물별 맞춤 메세지 생성 |
| 대시보드 | 미정 | 일일 리드/아웃리치/계정 상태 조회 |

---

## 8. 크롤링 계정 관리

### 계정 로테이션

| 항목 | 가이드라인 |
|---|---|
| 계정 풀 규모 | 3-5개 로테이션 |
| 계정당 일일 검색 수 | 최대 50건 |
| IP 할당 | 주거지 프록시 고정 IP, 계정당 1개 |
| 요청 간 딜레이 | 랜덤 5-15초 |
| 계정 양성 기간 | 크롤링 시작 전 최소 1주일 일반 사용 |

### 안티디텍션 조치

- 랜덤화된 검색 간격
- 사람처럼 보이는 스크롤 행동 시뮬레이션
- 세션 쿠키 유지
- 계정별 기기 핑거프린트 일관성 유지
- 동일 게시물을 여러 크롤링 계정에서 접근하지 않기

---

## 9. 작업 계정 관리

### 계정 풀 운영

하루 5-15건 수준의 저용량 발송이므로 계정 수명이 상대적으로 길다. 다만 자동화 특성상 정지 가능성은 항상 존재하므로 예비 계정을 유지한다.

| 계정 상태 | 수량 | 역할 |
|---|---|---|
| 활성 (발송 중) | 1-2개 | 일일 댓글/DM 발송 (로테이션) |
| 양성 중 | 1-2개 | 1-4주간 일반 사용으로 신뢰도 축적 |
| 예비 | 1-2개 | 정지 시 투입 가능한 대기 계정 |

**계정 양성 절차:**

| 주차 | 활동 | 목표 |
|------|------|------|
| 1주차 | 피부 관련 콘텐츠 좋아요/저장 | 플랫폼 신뢰도 확보 |
| 2주차 | 다른 유저 게시물에 자연스러운 댓글 5-10건/일 | 댓글 기능 활성화 |
| 3주차 | 간단한 게시물 1-2건 직접 업로드 | 콘텐츠 생산자로 인식 |
| 4주차 | 발송 계정으로 전환, 저용량부터 시작 | 아웃리치 시작 |

### 계정별 프록시 할당

- 크롤링 계정과 작업 계정은 **반드시 다른 프록시** 사용
- 작업 계정 1개당 고정 주거지 프록시 1개
- 정지된 계정의 프록시는 최소 2주 후 재사용

### 일일 한도

하루 발송 대상 자체가 5-15건 수준이므로 한도에 도달할 일은 적지만, 안전 상한선을 설정한다.

| 행동 | 일일 최대 | 비고 |
|---|---|---|
| 댓글 | 20건 | 각각 고유하고 맥락에 맞는 내용이어야 함 |
| DM | 5건 | 댓글보다 더 개인화된 메세지가 필요할 경우 |

### 건강 상태 모니터링

- 유저 신고율 추적
- 플랫폼 경고 모니터링
- 경고 발생 시 48시간 쿨다운 유지
- **자동 감지 항목:** 로그인 실패, 캡차 발생, 댓글 작성 실패, 페이지 접근 차단

### 에스컬레이션 기준

1. **주의**: 캡차 발생 → 해당 계정 발송 일시 중단, 수동 캡차 해결 후 재개
2. **경고**: 플랫폼 경고 수신 → 해당 계정 48시간 아웃리치 중단
3. **위험**: 계정 제한/정지 발생 → 해당 계정 폐기, 예비 계정 투입, 프록시 2주 격리

---

## 10. 퍼널 지표

### 대시보드 요구사항

- 일일 신규 크롤링 리드 수
- 일일 아웃리치 발송 수 (댓글 vs DM 구분)
- 의도 유형별 응답률
- 계정 건강 상태 (경고, 제한)

---

## 부록: 샤오홍슈 작업 계정 개설

### 기업 계정(企业号) 등록 절차

1. 준비물: 사업자등록증 (한국 것도 가능), 대표자 신분증
2. 샤오홍슈 비즈니스 플랫폼(business.xiaohongshu.com)에서 신청
3. 연간 인증비 납부: 600위안 (약 12만원)
4. 인증 심사 기간: 영업일 기준 3-7일
5. 혜택: 파란색 인증 마크, 광고 플랫폼 접근, 분석 대시보드

### 프로필 최적화

- 이름: 한국 피부미용 포지셔닝이 명확한 이름 (예: 首尔皮肤管理顾问)
- 소개글: 서비스 설명 + 위챗 암시 ("V信同名" = 위챗 아이디가 닉네임과 동일)
- 프로필 이미지: 전문적이고 신뢰감 있는 이미지 (클리닉 로고 또는 컨설턴트 사진)
- 고정 게시물: 가장 정보성 높은 콘텐츠 (가격 가이드 또는 FAQ)
